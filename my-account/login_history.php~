<?php
include_once 'files/header.php';
?>
<div class="title">سجلات دخول المجلدات</div>
<?php
if (isset($_REQUEST['action']) && $_REQUEST['action'] == 'folder') {
    $id = intval($_GET['id']);
    if ($id) {
    
    	if(intval($_GET['user_level'])==3){
		    $sql = mysqli_query($connect, "SELECT login.id,login.customerID,login.ip,login.browser,login.date,login.platform,folder.fname,folder.lname FROM login LEFT JOIN folder ON login.customerID=folder.id WHERE login.customerID='$id' AND user_level=3 ORDER BY login.id DESC LIMIT 50");
		    $num = mysqli_num_rows($sql);
		    if ($num > 0) {
		        ?>
		        <table class="table" width="95%">
		            <tr class="firstTR">
		                <th width="3%"></th>
		                <th>اسم المجلد</th>
		                <th>التاريخ</th>
		                <th>النظام</th>
		                <th>المتصفح</th>
		                <th>IP</th>
		                <th width="5%">حذف</th>
		            </tr>
		            <?php
		            $row_number=0;
		            while ($row1 = mysqli_fetch_array($sql)) {
		            $row_number=$row_number+1;
		                $id = $row1['id'];
		                ?>
		                <tr>
		                    <td><?php echo $row_number; ?></td>
		                    <td><a href="?action=folder&id=<?php echo $row1['customerID'] ?>&user_level=3"><?php echo $row1['fname'] . " " . $row1['lname']; ?></a></td>
		                    <td><?php echo $row1['date']; ?></td>
		                    <td><?php echo $row1['platform']; ?></td>
		                    <td><?php echo $row1['browser']; ?></td>
		                    <td><?php echo $row1['ip']; ?></td>
		                    <td><a href="?action=delete&id=<?php echo $id; ?>"><img width=25 src="resources/icons/delete.png" title="حذف الطلب" onclick="return confirm('هل تريد بالتأكيد حذف القسم ')"/></a></td>
		                </tr>
		                <?php
		            }
		        }
		        ?>
		    </table>
		    
        <?php
        }
       if(intval($_GET['user_level'])==1){ 
		    $sql = mysqli_query($connect, "SELECT login.id,login.customerID,login.ip,login.browser,login.date,login.platform,admin.fname FROM login LEFT JOIN admin ON login.customerID=admin.id WHERE login.customerID='$id' AND user_level=1 ORDER BY login.id DESC LIMIT 50");
		    $num = mysqli_num_rows($sql);
		    if ($num > 0) {
		        ?>
		        <table class="table" width="95%">
		            <tr class="firstTR">
		                <th width="3%"></th>
		                <th>اسم المجلد</th>
		                <th>التاريخ</th>
		                <th>النظام</th>
		                <th>المتصفح</th>
		                <th>IP</th>
		                <th width="5%">حذف</th>
		            </tr>
		            <?php
		            $row_number=0;
		            while ($row1 = mysqli_fetch_array($sql)) {
		                $id = $row1['id'];
		                $row_number=$row_number+1;
		                ?>
		                <tr>
		                    <td><?php echo $row_number; ?></td>
		                    <td><a href="?action=folder&id=<?php echo $row1['customerID'] ?>&user_level=1"><?php echo $row1['fname']; ?></a></td>
		                    <td><?php echo $row1['date']; ?></td>
		                    <td><?php echo $row1['platform']; ?></td>
		                    <td><?php echo $row1['browser']; ?></td>
		                    <td><?php echo $row1['ip']; ?></td>
		                    <td><a href="?action=delete&id=<?php echo $id; ?>"><img width=25 src="resources/icons/delete.png" title="حذف الطلب" onclick="return confirm('هل تريد بالتأكيد حذف القسم ')"/></a></td>
		                </tr>
		                <?php
		            }
		        }
		        ?>
		    </table>
        <?php
        }
    }
    exit();}
?>
<table class="table" width="95%">
    <tr class="firstTR">
        <th width="3%"></th>
        <th>اسم المجلد</th>
        <th>التاريخ</th>
        <th>الساعة</th>
        <th>النظام</th>
        <th>المتصفح</th>
        <th>IP</th>
        <th width="5%">حذف</th>
    </tr>
    <?php
        if (isset($_GET['page'])) {
        $currentPage = $_GET['page'];
    } else {
        $currentPage = 1;
    }
    $namePage = 'login_history.php';
    $prevPage = $currentPage - 1;
    $nextPage = $currentPage + 1;
    $perPage = 50;
    $start = ($currentPage - 1) * $perPage;

    $totalRows = mysqli_num_rows(mysqli_query($connect, "SELECT id FROM login where user_level=3"));
    if ($totalRows > 0) {
        $lastPage = ceil($totalRows / $perPage);

        if ((@$_GET['page']) > $lastPage) {
            die("<div id='error'>لقد طلبت صفحة خاطئة</div>");
        }
        $i = 0;
    $sql = mysqli_query($connect, "SELECT login.id,login.customerID,login.time,login.ip,login.browser,login.date,login.platform,folder.fname,folder.lname FROM login LEFT JOIN folder ON login.customerID=folder.id WHERE user_level=3 ORDER BY login.id DESC LIMIT $start,$perPage");
    $row_number=0;
    while ($row = mysqli_fetch_array($sql)) {
        $id = $row['id'];
        $row_number=$row_number+1;
        ?>
        <tr>
            <td><?php echo $row_number ; ?></td>
            <td><a href="?action=folder&id=<?php echo $row['customerID'] ?>&user_level=3"><?php echo $row['fname'] . " " . $row['lname']; ?></a></td>
            <td><?php echo $row['date']; ?></td>
            <td><?php echo $row['time']; ?></td>
            <td><?php echo $row['platform']; ?></td>
            <td><?php echo $row['browser']; ?></td>
            <td><?php echo $row['ip']; ?></td>
            <td><a href="?action=delete&id=<?php echo $id; ?>"><img width=25 src="resources/icons/delete.png" title="حذف الطلب" onclick="return confirm('هل تريد بالتأكيد حذف القسم ')"/></a></td>
        <?php
        }
    }
    ?>
</table>
<?php
echo '<div class="clear"></div><br/><center><div id="pagination">';
echo "<a class='pagers'>" . $currentPage . "|" . $lastPage . "</a>";
//echo "<br/>".$currentPage;
//////////////////////pervious
if ($currentPage == 1) {
    echo'';
} else {
    echo "<a class='pager' href='login_history.php?page=1'>  الأولى </a>";
    echo "<a class ='pager' href='login_history.php?page=" . $prevPage . "'>السابق</a>";
}
//////////////////////for loop for show numbers
for ($i = $currentPage - 3; $i <= $currentPage + 5; $i++) {
    if ($i > 0 && $i <= $lastPage) {
        if ($currentPage != $i) {
            echo"<a class='pager pagin' href='login_history.php?page=" . $i . "'>" . $i . "</a>";
        } else {
            echo"<a class='pagers'>" . $i . "</a>";
        }
    }
}
////////////////////////////////next
if ($currentPage == $lastPage) {
    echo'';
} else {
    echo"<a class ='pager pagin' href='login_history.php?page=" . $nextPage . "'>التالي</a>";
    echo "<a class='pager pagin' href='login_history.php?page=" . $lastPage . "'>الأخيرة</a>";
}
echo"</div></center>";
?>









<div class="title">سجلات دخول الادارة</div>



<table class="table" width="95%">
    <tr class="firstTR">
        <th width="3%"></th>
        <th>اسم المدير</th>
        <th>التاريخ</th>
        <th>الساعة</th>
        <th>النظام</th>
        <th>المتصفح</th>
        <th>IP</th>
        <th width="5%">حذف</th>
    </tr>
    <?php
        if (isset($_GET['page'])) {
        $currentPage = $_GET['page'];
    } else {
        $currentPage = 1;
    }
    $namePage = 'login_history.php';
    $prevPage = $currentPage - 1;
    $nextPage = $currentPage + 1;
    $perPage = 50;
    $start = ($currentPage - 1) * $perPage;

    $totalRows = mysqli_num_rows(mysqli_query($connect, "SELECT id FROM login where user_level=1"));
    if ($totalRows > 0) {
        $lastPage = ceil($totalRows / $perPage);

        if ((@$_GET['page']) > $lastPage) {
            die("<div id='error'>لقد طلبت صفحة خاطئة</div>");
        }
        $i = 0;
    $sql = mysqli_query($connect, "SELECT login.id,login.customerID,login.time,login.ip,login.browser,login.date,login.platform,admin.fname FROM login LEFT JOIN admin ON login.customerID=admin.id WHERE user_level=1  ORDER BY login.id DESC LIMIT $start,$perPage");
    
    $row_number=0;
    while ($row = mysqli_fetch_array($sql)) {
    	$row_number=$row_number+1;
        $id = $row['id'];
        ?>
        <tr>
            <td><?php echo $row_number; ?></td>
            <td><a href="?action=folder&id=<?php echo $row['customerID'] ?>&user_level=1"><?php echo $row['fname']; ?></a></td>
            <td><?php echo $row['date']; ?></td>
            <td><?php echo $row['time']; ?></td>
            <td><?php echo $row['platform']; ?></td>
            <td><?php echo $row['browser']; ?></td>
            <td><?php echo $row['ip']; ?></td>
            <td><a href="?action=delete&id=<?php echo $id; ?>"><img width=25 src="resources/icons/delete.png" title="حذف الطلب" onclick="return confirm('هل تريد بالتأكيد حذف القسم ')"/></a></td>
        <?php
        }
    }
    ?>
</table>
<?php
echo '<div class="clear"></div><br/><center><div id="pagination">';
echo "<a class='pagers'>" . $currentPage . "|" . $lastPage . "</a>";
//echo "<br/>".$currentPage;
//////////////////////pervious
if ($currentPage == 1) {
    echo'';
} else {
    echo "<a class='pager' href='login_history.php?page=1'>  الأولى </a>";
    echo "<a class ='pager' href='login_history.php?page=" . $prevPage . "'>السابق</a>";
}
//////////////////////for loop for show numbers
for ($i = $currentPage - 3; $i <= $currentPage + 5; $i++) {
    if ($i > 0 && $i <= $lastPage) {
        if ($currentPage != $i) {
            echo"<a class='pager pagin' href='login_history.php?page=" . $i . "'>" . $i . "</a>";
        } else {
            echo"<a class='pagers'>" . $i . "</a>";
        }
    }
}
////////////////////////////////next
if ($currentPage == $lastPage) {
    echo'';
} else {
    echo"<a class ='pager pagin' href='login_history.php?page=" . $nextPage . "'>التالي</a>";
    echo "<a class='pager pagin' href='login_history.php?page=" . $lastPage . "'>الأخيرة</a>";
}
echo"</div></center>";
?>
<?php
include_once 'files/footer.php';
?>
